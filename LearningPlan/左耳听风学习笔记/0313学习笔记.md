# 0313左耳听风学习笔记

## 分布式系统关键技术：流量与数据调度
1、服务治理应该是内部系统的事，而流量调度可以是内部的，更是外部接入层的事。
2、服务治理是数据中心的事，而流量调度要做的好，应该是数据中心之外的事，也就是我们常说的边缘计算，是应该在类似于CDN上完成的事。
所以在系统架构上应该将服务治理和流量调度分开。
### 流量调度的主要功能
- 依据系统运行的情况，自动的进行流量调度，在无需人工干预的情况下，提升整个系统的稳定性；
- 让系统应对爆品等突发事件时，在弹性计算扩缩容的较长时间窗口内或底层资源消耗殆尽的情况下，保护系统平稳运行。

这还是为了提高系统架构的稳定性和高可用性。
流量调度系统还可以完成
- `服务流控`。服务发现、服务路由、服务降级、服务熔断、服务保护等。
- `流量控制`。负载均衡、流量分配、流量控制、异地灾备（多活）等。
- `流量管理`。协议转换、请求校验、数据缓存、数据计算等。

### 流量调度的关键技术
一个好的API Gateway（流量调度）需要具备以下的关键技术
- `高性能`。API Gateway必须使用高性能的技术，所以，也就需要使用高性能的语言。
- `抗流量`。要能抗流量，就需要使用集群技术。集群技术的关键点是在集群内的各个节点中共享数据。这就需要使用像Paxos、Raft、Gossip这样的通讯协议。因为API Gateway需要部署在广域网上，所以还需要集群的分组技术。
- `业务逻辑`。API Gateway需要有简单的业务逻辑，所以，最好是像AWS的Lambda服务一样，可以让人注入不同语言的简单业务逻辑。
- `服务化`。一个好的API Gateway需要能够通过Admin API来不停机地管理配置变更，而不是通过一个.conf文件来人肉地修改配置。

现阶段，可以做成这样的API Gateway还没有。

### 状态数据调度
有些服务会保存一些数据，而这些数据是不能丢失的，所有，这些数据是需要随服务一起调度的。
我们一般是将这些状态数据存储到Redis、MySQL、ZooKeeper等第三方服务上， 所以我们可以看到，现在的分布式系统架构中出问题的基本都是这些存储状态的服务。
因为数据存储节点在Scale上比较困难，所以成了一个单点的瓶颈。
### 分布式事务一致性的问题
让数据服务可以像无状态的服务一样在不同的机器上进行调度，这就会涉及数据的replication问题。而数据replication则会带来数据一致性的问题，进而对性能带来严重的影响。
要解决数据不丢失的问题，只能通过数据冗余的方法。数据副本是分布式系统解决数据丢失异常的唯一手段。
- 要想让数据有高可用性，就得写多份数据
- 写多份会引起数据一致性的问题
- 数据一致性的问题又会引发性能问题

解决数据副本间的一致性问题，我们的技术手段
- Master-Slave方案。
- Master-Master方案。
- 两阶段和三阶段提交方案。
- Paxos方案。

现阶段，在应用层上解决事务问题，只有“两阶段提交”这样的方式，在数据层解决事务问题，Paxos算法则是不二之选。

### 数据节点的分布式方案
真正解决数据节点调度的方案应该是底层的数据节点。

此文章为3月Day6学习笔记，内容来源于：极客时间《左耳听风》，强烈推荐此课程。

![](../../img/20230306234244.jpg)